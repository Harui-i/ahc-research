# syntax=docker/dockerfile:1
FROM ubuntu:24.04

SHELL ["/bin/bash", "-c"]

ARG INSTALL_TOML=src/cpython/082-3-13_cpython.toml
WORKDIR /tmp

# Pre-install tools needed to unpack and run the AtCoder install script.
RUN apt-get update \
    && apt-get install -y --no-install-recommends \
        ca-certificates \
        python3 \
        python3-pip \
        python3-venv \
        wget \
    && rm -rf /var/lib/apt/lists/*

# Copy the AtCoder language definition so we can extract the embedded install script.
COPY ${INSTALL_TOML} /tmp/install.toml

# Extract the install script from the TOML and remove sudo so it can run as root.
RUN set -euo pipefail; \
    python3 - <<'PY' >/tmp/install.sh
import tomllib
from pathlib import Path
install = tomllib.loads(Path("/tmp/install.toml").read_text())
script = install["install"].replace("sudo ", "")
Path("/tmp/install.sh").write_text(script)
PY

# Run the AtCoder-provided install script.
RUN bash /tmp/install.sh && rm /tmp/install.sh /tmp/install.toml

CMD ["python3.13", "--version"]
